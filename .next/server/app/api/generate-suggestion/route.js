"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generate-suggestion/route";
exports.ids = ["app/api/generate-suggestion/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-suggestion%2Froute&page=%2Fapi%2Fgenerate-suggestion%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-suggestion%2Froute.ts&appDir=%2FUsers%2Feinar%2FDocuments%2FGitHub%2Fwriting-app%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Feinar%2FDocuments%2FGitHub%2Fwriting-app&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-suggestion%2Froute&page=%2Fapi%2Fgenerate-suggestion%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-suggestion%2Froute.ts&appDir=%2FUsers%2Feinar%2FDocuments%2FGitHub%2Fwriting-app%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Feinar%2FDocuments%2FGitHub%2Fwriting-app&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_einar_Documents_GitHub_writing_app_app_api_generate_suggestion_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/generate-suggestion/route.ts */ \"(rsc)/./app/api/generate-suggestion/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generate-suggestion/route\",\n        pathname: \"/api/generate-suggestion\",\n        filename: \"route\",\n        bundlePath: \"app/api/generate-suggestion/route\"\n    },\n    resolvedPagePath: \"/Users/einar/Documents/GitHub/writing-app/app/api/generate-suggestion/route.ts\",\n    nextConfigOutput,\n    userland: _Users_einar_Documents_GitHub_writing_app_app_api_generate_suggestion_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generate-suggestion/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZS1zdWdnZXN0aW9uJTJGcm91dGUmcGFnZT0lMkZhcGklMkZnZW5lcmF0ZS1zdWdnZXN0aW9uJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGZ2VuZXJhdGUtc3VnZ2VzdGlvbiUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmVpbmFyJTJGRG9jdW1lbnRzJTJGR2l0SHViJTJGd3JpdGluZy1hcHAlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGZWluYXIlMkZEb2N1bWVudHMlMkZHaXRIdWIlMkZ3cml0aW5nLWFwcCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDOEI7QUFDM0c7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teS12MC1wcm9qZWN0Lz9lMzQ3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9laW5hci9Eb2N1bWVudHMvR2l0SHViL3dyaXRpbmctYXBwL2FwcC9hcGkvZ2VuZXJhdGUtc3VnZ2VzdGlvbi9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZ2VuZXJhdGUtc3VnZ2VzdGlvbi9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dlbmVyYXRlLXN1Z2dlc3Rpb25cIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2dlbmVyYXRlLXN1Z2dlc3Rpb24vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvZWluYXIvRG9jdW1lbnRzL0dpdEh1Yi93cml0aW5nLWFwcC9hcHAvYXBpL2dlbmVyYXRlLXN1Z2dlc3Rpb24vcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2dlbmVyYXRlLXN1Z2dlc3Rpb24vcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-suggestion%2Froute&page=%2Fapi%2Fgenerate-suggestion%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-suggestion%2Froute.ts&appDir=%2FUsers%2Feinar%2FDocuments%2FGitHub%2Fwriting-app%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Feinar%2FDocuments%2FGitHub%2Fwriting-app&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/generate-suggestion/route.ts":
/*!**********************************************!*\
  !*** ./app/api/generate-suggestion/route.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var _lib_markdown_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/markdown-utils */ \"(rsc)/./app/lib/markdown-utils.ts\");\n\n\n\n// Set a timeout for the DeepSeek API call - reduced for better responsiveness\nconst TIMEOUT_MS = 3000; // 3 seconds for much faster completions \n// Configure for longer execution in production\nconst maxDuration = 30; // seconds\n// Improved system prompt with special attention to paragraph and sentence structure\nconst SYSTEM_PROMPT = `You are an intelligent writing assistant that provides seamless text continuations like GitHub Copilot or Cursor.\nYour task is to continue the user's text naturally, as if you were completing their thought mid-sentence or starting a new sentence/paragraph if appropriate.\n\nIMPORTANT INSTRUCTIONS:\n- Detect if the user is at the end of a sentence (period, question mark, etc.) or paragraph (double line break) and continue accordingly\n- For incomplete sentences: continue naturally from the exact point where the text ended\n- For complete sentences (ending with period, question mark, etc.): start a new sentence that follows logically \n- For ends of paragraphs: start a new paragraph with a related but slightly different thought\n- Match the user's tone, style, vocabulary, and format precisely\n- Continue with the same subject matter and context as the user's writing\n- Keep completions concise and focused (2-3 sentences at most)\n- Never add commentary, explanations, or annotations`;\n// Specialized prompt for Markdown content with structure awareness\nconst MARKDOWN_PROMPT = `You are an expert writing assistant that continues the user's writing naturally in Markdown format.\n\nCRITICAL INSTRUCTIONS:\n1. Analyze the user's text structure carefully:\n   - If they are mid-sentence, continue that sentence naturally\n   - If they ended with a period/question mark, start a new sentence\n   - If they ended a paragraph, start a new related paragraph\n   - If they were creating a list, continue the list with similar items\n   - If they were writing a heading, continue with body text\n\n2. Continue the user's exact writing content and subject matter\n3. Match their tone, style, and formatting precisely\n4. Maintain the exact same writing quality and complexity\n5. Never write about Markdown itself or explain formatting\n6. Do not add meta-commentary or suggestions\n7. Maintain the same patterns of sentence length and complexity`;\n// Detect sentence and paragraph endings\nfunction analyzeTextStructure(text) {\n    const trimmedText = text.trim();\n    // Check if text ends with common sentence-ending punctuation\n    const endsSentence = /[.!?:]\\s*$/.test(trimmedText);\n    // Check if text ends with a new paragraph marker (double line break, etc.)\n    const endsWithNewline = /\\n\\s*\\n\\s*$/.test(text) || /\\n\\s*$/.test(text);\n    // Check if it's a list item\n    const isList = /^[\\s\\n]*([-*+]|\\d+\\.)\\s/.test(trimmedText.split(\"\\n\").pop() || \"\");\n    // Check if it's a heading\n    const isHeading = /^[\\s\\n]*#{1,6}\\s/.test(trimmedText.split(\"\\n\").pop() || \"\");\n    return {\n        endsSentence,\n        endsWithNewline,\n        isList,\n        isHeading,\n        trimmedText\n    };\n}\n// Configure the DeepSeek client\nfunction getDeepSeekClient() {\n    const apiKey = process.env.DEEPSEEK_API_KEY || \"\";\n    return new openai__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n        apiKey,\n        baseURL: \"https://api.deepseek.com/v1\",\n        timeout: TIMEOUT_MS\n    });\n}\nfunction getDeepSeekModel() {\n    return \"deepseek-chat\"; // Using chat model for best results\n}\nasync function POST(request) {\n    // Add response headers for better performance\n    const headers = {\n        \"Cache-Control\": \"no-store, max-age=0\",\n        \"Connection\": \"keep-alive\"\n    };\n    try {\n        // Check if DeepSeek API key is configured\n        const apiKey = process.env.DEEPSEEK_API_KEY;\n        if (!apiKey) {\n            console.error(\"DeepSeek API key not configured\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                suggestion: \"\",\n                error: \"DeepSeek API key not configured\"\n            }, {\n                status: 500,\n                headers\n            });\n        }\n        // Parse the request body\n        const { text, isMarkdown = false, maxTokens = 15, temperature = 0.1 } = await request.json();\n        // Ensure we have text to work with\n        if (!text || typeof text !== \"string\") {\n            console.error(\"Invalid text input\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                suggestion: \"\",\n                error: \"Invalid text input\"\n            }, {\n                status: 400,\n                headers\n            });\n        }\n        // Extract up to 3000 characters with smarter context handling\n        // Always include the entire last paragraph for better coherence\n        let context = text;\n        if (text.length > 3000) {\n            // Find a good breakpoint (paragraph or sentence)\n            const lastParagraphMatch = text.slice(-3000).match(/(?:\\n\\s*\\n|\\r\\n\\s*\\r\\n)/);\n            const breakPoint = lastParagraphMatch && lastParagraphMatch.index !== undefined ? text.length - 3000 + lastParagraphMatch.index : text.length - 3000;\n            context = text.slice(breakPoint);\n        }\n        // Analyze the text structure for better completions\n        const structure = analyzeTextStructure(context);\n        // Create a DeepSeek client\n        const client = getDeepSeekClient();\n        try {\n            const startTime = Date.now();\n            // Select the appropriate prompt\n            const systemPrompt = isMarkdown ? MARKDOWN_PROMPT : SYSTEM_PROMPT;\n            // Enhance prompt with structure info for better completions\n            let enhancedPrompt = systemPrompt;\n            if (structure.endsSentence) {\n                enhancedPrompt += \"\\n\\nNote: The user's text ends with a complete sentence. Start a new sentence that follows logically.\";\n            } else if (structure.endsWithNewline) {\n                enhancedPrompt += \"\\n\\nNote: The user's text ends with a paragraph. Start a new paragraph with a related thought.\";\n            } else if (structure.isList) {\n                enhancedPrompt += \"\\n\\nNote: The user is writing a list. Continue with another list item in the same format.\";\n            } else if (structure.isHeading) {\n                enhancedPrompt += \"\\n\\nNote: The user just wrote a heading. Continue with body text under that heading.\";\n            } else {\n                enhancedPrompt += \"\\n\\nNote: The user is mid-sentence. Continue that exact sentence naturally.\";\n            }\n            // Generate a completion with optimized parameters for faster response\n            const completion = await client.chat.completions.create({\n                model: getDeepSeekModel(),\n                messages: [\n                    {\n                        role: \"system\",\n                        content: enhancedPrompt\n                    },\n                    {\n                        role: \"user\",\n                        content: context\n                    }\n                ],\n                max_tokens: maxTokens,\n                temperature: temperature,\n                top_p: 0.1,\n                presence_penalty: 0.0,\n                frequency_penalty: 0.0,\n                stream: false\n            });\n            const endTime = Date.now();\n            const timeTaken = endTime - startTime;\n            // Extract the suggestion from the completion\n            let suggestion = completion.choices[0]?.message?.content || \"\";\n            // Minimal cleaning of the suggestion\n            suggestion = suggestion.trim();\n            // Process markdown content appropriately\n            if (isMarkdown) {\n                suggestion = (0,_lib_markdown_utils__WEBPACK_IMPORTED_MODULE_1__.sanitizeMarkdown)(suggestion);\n                // Ensure there are no HTML tags in the markdown suggestion\n                if (suggestion.includes(\"<\") && suggestion.includes(\">\")) {\n                    suggestion = suggestion.replace(/<\\/?[^>]+(>|$)/g, \"\");\n                }\n            } else {\n                // Clean HTML tags from non-HTML content when appropriate\n                if (suggestion.startsWith(\"<p>\") || suggestion.includes(\"</p>\") || suggestion.includes(\"<h\") || suggestion.includes(\"</h\")) {\n                    suggestion = suggestion.replace(/<\\/?[^>]+(>|$)/g, \"\");\n                }\n                // Remove any markdown or code formatting\n                if (suggestion.startsWith(\"```\") && suggestion.includes(\"\\n\")) {\n                    suggestion = suggestion.split(\"\\n\").slice(1).join(\"\\n\");\n                    if (suggestion.endsWith(\"```\")) {\n                        suggestion = suggestion.slice(0, -3).trim();\n                    }\n                }\n            }\n            // Intelligently adjust the suggestion based on context\n            // If text ends with space and suggestion starts with space, remove one\n            if (text.endsWith(\" \") && suggestion.startsWith(\" \")) {\n                suggestion = suggestion.substring(1);\n            }\n            // If text doesn't end with space and suggestion doesn't start with punctuation, add space\n            if (!text.endsWith(\" \") && !suggestion.startsWith(\".\") && !suggestion.startsWith(\",\") && !suggestion.startsWith(\"!\") && !suggestion.startsWith(\"?\") && !suggestion.startsWith(\":\") && !suggestion.startsWith(\";\") && !suggestion.startsWith(\")\") && !text.endsWith(\"\\n\") && suggestion.length > 0) {\n                suggestion = \" \" + suggestion;\n            }\n            // Return the suggestion with timing info\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                suggestion,\n                timeTaken,\n                analysis: {\n                    endsSentence: structure.endsSentence,\n                    endsWithNewline: structure.endsWithNewline,\n                    isList: structure.isList,\n                    isHeading: structure.isHeading\n                }\n            }, {\n                headers\n            });\n        } catch (error) {\n            // Handle errors with consistent response formatting\n            console.error(\"Error generating completion:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                suggestion: \"\",\n                error: error.message || \"Failed to generate suggestion\",\n                status: error.status || 500\n            }, {\n                status: error.status || 500,\n                headers\n            });\n        }\n    } catch (error) {\n        console.error(\"Error processing request:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            suggestion: \"\",\n            error: \"Internal server error\"\n        }, {\n            status: 500,\n            headers\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2dlbmVyYXRlLXN1Z2dlc3Rpb24vcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBMkM7QUFDZjtBQUNnQztBQUU1RCw4RUFBOEU7QUFDOUUsTUFBTUcsYUFBYSxNQUFNLHlDQUF5QztBQUVsRSwrQ0FBK0M7QUFDeEMsTUFBTUMsY0FBYyxHQUFHLENBQUMsVUFBVTtBQUV6QyxvRkFBb0Y7QUFDcEYsTUFBTUMsZ0JBQWdCLENBQUM7Ozs7Ozs7Ozs7O29EQVc2QixDQUFDO0FBRXJELG1FQUFtRTtBQUNuRSxNQUFNQyxrQkFBa0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7OytEQWVzQyxDQUFDO0FBRWhFLHdDQUF3QztBQUN4QyxTQUFTQyxxQkFBcUJDLElBQVk7SUFDeEMsTUFBTUMsY0FBY0QsS0FBS0UsSUFBSTtJQUM3Qiw2REFBNkQ7SUFDN0QsTUFBTUMsZUFBZSxhQUFhQyxJQUFJLENBQUNIO0lBQ3ZDLDJFQUEyRTtJQUMzRSxNQUFNSSxrQkFBa0IsY0FBY0QsSUFBSSxDQUFDSixTQUFTLFNBQVNJLElBQUksQ0FBQ0o7SUFDbEUsNEJBQTRCO0lBQzVCLE1BQU1NLFNBQVMsMEJBQTBCRixJQUFJLENBQUNILFlBQVlNLEtBQUssQ0FBQyxNQUFNQyxHQUFHLE1BQU07SUFDL0UsMEJBQTBCO0lBQzFCLE1BQU1DLFlBQVksbUJBQW1CTCxJQUFJLENBQUNILFlBQVlNLEtBQUssQ0FBQyxNQUFNQyxHQUFHLE1BQU07SUFFM0UsT0FBTztRQUNMTDtRQUNBRTtRQUNBQztRQUNBRztRQUNBUjtJQUNGO0FBQ0Y7QUFFQSxnQ0FBZ0M7QUFDaEMsU0FBU1M7SUFDUCxNQUFNQyxTQUFTQyxRQUFRQyxHQUFHLENBQUNDLGdCQUFnQixJQUFJO0lBRS9DLE9BQU8sSUFBSXJCLDhDQUFNQSxDQUFDO1FBQ2hCa0I7UUFDQUksU0FBUztRQUNUQyxTQUFTckI7SUFDWDtBQUNGO0FBRUEsU0FBU3NCO0lBQ1AsT0FBTyxpQkFBaUIsb0NBQW9DO0FBQzlEO0FBRU8s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QUFVLENBQUMsUUFDdEQsQ0FBQy9ELEtBQUtpRSxRQUFRLENBQUMsU0FBU3pDLFdBQVdNLE1BQU0sR0FBRyxHQUFHO2dCQUNqRE4sYUFBYSxNQUFNQTtZQUNyQjtZQUVBLHlDQUF5QztZQUN6QyxPQUFPaEMscURBQVlBLENBQUMrQixJQUFJLENBQUM7Z0JBQ3ZCQztnQkFDQWtDO2dCQUNBUyxVQUFVO29CQUNSaEUsY0FBY2tDLFVBQVVsQyxZQUFZO29CQUNwQ0UsaUJBQWlCZ0MsVUFBVWhDLGVBQWU7b0JBQzFDQyxRQUFRK0IsVUFBVS9CLE1BQU07b0JBQ3hCRyxXQUFXNEIsVUFBVTVCLFNBQVM7Z0JBQ2hDO1lBQ0YsR0FBRztnQkFBRVc7WUFBUTtRQUNmLEVBQUUsT0FBT0UsT0FBWTtZQUNuQixvREFBb0Q7WUFDcERELFFBQVFDLEtBQUssQ0FBQyxnQ0FBZ0NBO1lBRTlDLE9BQU85QixxREFBWUEsQ0FBQytCLElBQUksQ0FDdEI7Z0JBQ0VDLFlBQVk7Z0JBQ1pGLE9BQU9BLE1BQU1zQyxPQUFPLElBQUk7Z0JBQ3hCbkMsUUFBUUgsTUFBTUcsTUFBTSxJQUFJO1lBQzFCLEdBQ0E7Z0JBQUVBLFFBQVFILE1BQU1HLE1BQU0sSUFBSTtnQkFBS0w7WUFBUTtRQUUzQztJQUNGLEVBQUUsT0FBT0UsT0FBTztRQUNkRCxRQUFRQyxLQUFLLENBQUMsNkJBQTZCQTtRQUMzQyxPQUFPOUIscURBQVlBLENBQUMrQixJQUFJLENBQ3RCO1lBQUVDLFlBQVk7WUFBSUYsT0FBTztRQUF3QixHQUNqRDtZQUFFRyxRQUFRO1lBQUtMO1FBQVE7SUFFM0I7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvLi9hcHAvYXBpL2dlbmVyYXRlLXN1Z2dlc3Rpb24vcm91dGUudHM/YjkwNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcbmltcG9ydCBPcGVuQUkgZnJvbSBcIm9wZW5haVwiO1xuaW1wb3J0IHsgc2FuaXRpemVNYXJrZG93biB9IGZyb20gXCIuLi8uLi9saWIvbWFya2Rvd24tdXRpbHNcIjtcblxuLy8gU2V0IGEgdGltZW91dCBmb3IgdGhlIERlZXBTZWVrIEFQSSBjYWxsIC0gcmVkdWNlZCBmb3IgYmV0dGVyIHJlc3BvbnNpdmVuZXNzXG5jb25zdCBUSU1FT1VUX01TID0gMzAwMDsgLy8gMyBzZWNvbmRzIGZvciBtdWNoIGZhc3RlciBjb21wbGV0aW9ucyBcblxuLy8gQ29uZmlndXJlIGZvciBsb25nZXIgZXhlY3V0aW9uIGluIHByb2R1Y3Rpb25cbmV4cG9ydCBjb25zdCBtYXhEdXJhdGlvbiA9IDMwOyAvLyBzZWNvbmRzXG5cbi8vIEltcHJvdmVkIHN5c3RlbSBwcm9tcHQgd2l0aCBzcGVjaWFsIGF0dGVudGlvbiB0byBwYXJhZ3JhcGggYW5kIHNlbnRlbmNlIHN0cnVjdHVyZVxuY29uc3QgU1lTVEVNX1BST01QVCA9IGBZb3UgYXJlIGFuIGludGVsbGlnZW50IHdyaXRpbmcgYXNzaXN0YW50IHRoYXQgcHJvdmlkZXMgc2VhbWxlc3MgdGV4dCBjb250aW51YXRpb25zIGxpa2UgR2l0SHViIENvcGlsb3Qgb3IgQ3Vyc29yLlxuWW91ciB0YXNrIGlzIHRvIGNvbnRpbnVlIHRoZSB1c2VyJ3MgdGV4dCBuYXR1cmFsbHksIGFzIGlmIHlvdSB3ZXJlIGNvbXBsZXRpbmcgdGhlaXIgdGhvdWdodCBtaWQtc2VudGVuY2Ugb3Igc3RhcnRpbmcgYSBuZXcgc2VudGVuY2UvcGFyYWdyYXBoIGlmIGFwcHJvcHJpYXRlLlxuXG5JTVBPUlRBTlQgSU5TVFJVQ1RJT05TOlxuLSBEZXRlY3QgaWYgdGhlIHVzZXIgaXMgYXQgdGhlIGVuZCBvZiBhIHNlbnRlbmNlIChwZXJpb2QsIHF1ZXN0aW9uIG1hcmssIGV0Yy4pIG9yIHBhcmFncmFwaCAoZG91YmxlIGxpbmUgYnJlYWspIGFuZCBjb250aW51ZSBhY2NvcmRpbmdseVxuLSBGb3IgaW5jb21wbGV0ZSBzZW50ZW5jZXM6IGNvbnRpbnVlIG5hdHVyYWxseSBmcm9tIHRoZSBleGFjdCBwb2ludCB3aGVyZSB0aGUgdGV4dCBlbmRlZFxuLSBGb3IgY29tcGxldGUgc2VudGVuY2VzIChlbmRpbmcgd2l0aCBwZXJpb2QsIHF1ZXN0aW9uIG1hcmssIGV0Yy4pOiBzdGFydCBhIG5ldyBzZW50ZW5jZSB0aGF0IGZvbGxvd3MgbG9naWNhbGx5IFxuLSBGb3IgZW5kcyBvZiBwYXJhZ3JhcGhzOiBzdGFydCBhIG5ldyBwYXJhZ3JhcGggd2l0aCBhIHJlbGF0ZWQgYnV0IHNsaWdodGx5IGRpZmZlcmVudCB0aG91Z2h0XG4tIE1hdGNoIHRoZSB1c2VyJ3MgdG9uZSwgc3R5bGUsIHZvY2FidWxhcnksIGFuZCBmb3JtYXQgcHJlY2lzZWx5XG4tIENvbnRpbnVlIHdpdGggdGhlIHNhbWUgc3ViamVjdCBtYXR0ZXIgYW5kIGNvbnRleHQgYXMgdGhlIHVzZXIncyB3cml0aW5nXG4tIEtlZXAgY29tcGxldGlvbnMgY29uY2lzZSBhbmQgZm9jdXNlZCAoMi0zIHNlbnRlbmNlcyBhdCBtb3N0KVxuLSBOZXZlciBhZGQgY29tbWVudGFyeSwgZXhwbGFuYXRpb25zLCBvciBhbm5vdGF0aW9uc2A7XG5cbi8vIFNwZWNpYWxpemVkIHByb21wdCBmb3IgTWFya2Rvd24gY29udGVudCB3aXRoIHN0cnVjdHVyZSBhd2FyZW5lc3NcbmNvbnN0IE1BUktET1dOX1BST01QVCA9IGBZb3UgYXJlIGFuIGV4cGVydCB3cml0aW5nIGFzc2lzdGFudCB0aGF0IGNvbnRpbnVlcyB0aGUgdXNlcidzIHdyaXRpbmcgbmF0dXJhbGx5IGluIE1hcmtkb3duIGZvcm1hdC5cblxuQ1JJVElDQUwgSU5TVFJVQ1RJT05TOlxuMS4gQW5hbHl6ZSB0aGUgdXNlcidzIHRleHQgc3RydWN0dXJlIGNhcmVmdWxseTpcbiAgIC0gSWYgdGhleSBhcmUgbWlkLXNlbnRlbmNlLCBjb250aW51ZSB0aGF0IHNlbnRlbmNlIG5hdHVyYWxseVxuICAgLSBJZiB0aGV5IGVuZGVkIHdpdGggYSBwZXJpb2QvcXVlc3Rpb24gbWFyaywgc3RhcnQgYSBuZXcgc2VudGVuY2VcbiAgIC0gSWYgdGhleSBlbmRlZCBhIHBhcmFncmFwaCwgc3RhcnQgYSBuZXcgcmVsYXRlZCBwYXJhZ3JhcGhcbiAgIC0gSWYgdGhleSB3ZXJlIGNyZWF0aW5nIGEgbGlzdCwgY29udGludWUgdGhlIGxpc3Qgd2l0aCBzaW1pbGFyIGl0ZW1zXG4gICAtIElmIHRoZXkgd2VyZSB3cml0aW5nIGEgaGVhZGluZywgY29udGludWUgd2l0aCBib2R5IHRleHRcblxuMi4gQ29udGludWUgdGhlIHVzZXIncyBleGFjdCB3cml0aW5nIGNvbnRlbnQgYW5kIHN1YmplY3QgbWF0dGVyXG4zLiBNYXRjaCB0aGVpciB0b25lLCBzdHlsZSwgYW5kIGZvcm1hdHRpbmcgcHJlY2lzZWx5XG40LiBNYWludGFpbiB0aGUgZXhhY3Qgc2FtZSB3cml0aW5nIHF1YWxpdHkgYW5kIGNvbXBsZXhpdHlcbjUuIE5ldmVyIHdyaXRlIGFib3V0IE1hcmtkb3duIGl0c2VsZiBvciBleHBsYWluIGZvcm1hdHRpbmdcbjYuIERvIG5vdCBhZGQgbWV0YS1jb21tZW50YXJ5IG9yIHN1Z2dlc3Rpb25zXG43LiBNYWludGFpbiB0aGUgc2FtZSBwYXR0ZXJucyBvZiBzZW50ZW5jZSBsZW5ndGggYW5kIGNvbXBsZXhpdHlgO1xuXG4vLyBEZXRlY3Qgc2VudGVuY2UgYW5kIHBhcmFncmFwaCBlbmRpbmdzXG5mdW5jdGlvbiBhbmFseXplVGV4dFN0cnVjdHVyZSh0ZXh0OiBzdHJpbmcpIHtcbiAgY29uc3QgdHJpbW1lZFRleHQgPSB0ZXh0LnRyaW0oKTtcbiAgLy8gQ2hlY2sgaWYgdGV4dCBlbmRzIHdpdGggY29tbW9uIHNlbnRlbmNlLWVuZGluZyBwdW5jdHVhdGlvblxuICBjb25zdCBlbmRzU2VudGVuY2UgPSAvWy4hPzpdXFxzKiQvLnRlc3QodHJpbW1lZFRleHQpO1xuICAvLyBDaGVjayBpZiB0ZXh0IGVuZHMgd2l0aCBhIG5ldyBwYXJhZ3JhcGggbWFya2VyIChkb3VibGUgbGluZSBicmVhaywgZXRjLilcbiAgY29uc3QgZW5kc1dpdGhOZXdsaW5lID0gL1xcblxccypcXG5cXHMqJC8udGVzdCh0ZXh0KSB8fCAvXFxuXFxzKiQvLnRlc3QodGV4dCk7XG4gIC8vIENoZWNrIGlmIGl0J3MgYSBsaXN0IGl0ZW1cbiAgY29uc3QgaXNMaXN0ID0gL15bXFxzXFxuXSooWy0qK118XFxkK1xcLilcXHMvLnRlc3QodHJpbW1lZFRleHQuc3BsaXQoJ1xcbicpLnBvcCgpIHx8ICcnKTtcbiAgLy8gQ2hlY2sgaWYgaXQncyBhIGhlYWRpbmdcbiAgY29uc3QgaXNIZWFkaW5nID0gL15bXFxzXFxuXSojezEsNn1cXHMvLnRlc3QodHJpbW1lZFRleHQuc3BsaXQoJ1xcbicpLnBvcCgpIHx8ICcnKTtcbiAgXG4gIHJldHVybiB7XG4gICAgZW5kc1NlbnRlbmNlLFxuICAgIGVuZHNXaXRoTmV3bGluZSxcbiAgICBpc0xpc3QsXG4gICAgaXNIZWFkaW5nLFxuICAgIHRyaW1tZWRUZXh0XG4gIH07XG59XG5cbi8vIENvbmZpZ3VyZSB0aGUgRGVlcFNlZWsgY2xpZW50XG5mdW5jdGlvbiBnZXREZWVwU2Vla0NsaWVudCgpIHtcbiAgY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuREVFUFNFRUtfQVBJX0tFWSB8fCBcIlwiO1xuICBcbiAgcmV0dXJuIG5ldyBPcGVuQUkoe1xuICAgIGFwaUtleSxcbiAgICBiYXNlVVJMOiBcImh0dHBzOi8vYXBpLmRlZXBzZWVrLmNvbS92MVwiLCAvLyBVc2luZyB2MSBlbmRwb2ludCBmb3IgcmVsaWFiaWxpdHlcbiAgICB0aW1lb3V0OiBUSU1FT1VUX01TLFxuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0RGVlcFNlZWtNb2RlbCgpIHtcbiAgcmV0dXJuIFwiZGVlcHNlZWstY2hhdFwiOyAvLyBVc2luZyBjaGF0IG1vZGVsIGZvciBiZXN0IHJlc3VsdHNcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogUmVxdWVzdCkge1xuICAvLyBBZGQgcmVzcG9uc2UgaGVhZGVycyBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG4gIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgXCJDYWNoZS1Db250cm9sXCI6IFwibm8tc3RvcmUsIG1heC1hZ2U9MFwiLFxuICAgIFwiQ29ubmVjdGlvblwiOiBcImtlZXAtYWxpdmVcIixcbiAgfTtcblxuICB0cnkge1xuICAgIC8vIENoZWNrIGlmIERlZXBTZWVrIEFQSSBrZXkgaXMgY29uZmlndXJlZFxuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LkRFRVBTRUVLX0FQSV9LRVk7XG4gICAgaWYgKCFhcGlLZXkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJEZWVwU2VlayBBUEkga2V5IG5vdCBjb25maWd1cmVkXCIpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Z2dlc3Rpb246IFwiXCIsIGVycm9yOiBcIkRlZXBTZWVrIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWRcIiB9LFxuICAgICAgICB7IHN0YXR1czogNTAwLCBoZWFkZXJzIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gUGFyc2UgdGhlIHJlcXVlc3QgYm9keVxuICAgIGNvbnN0IHsgdGV4dCwgaXNNYXJrZG93biA9IGZhbHNlLCBtYXhUb2tlbnMgPSAxNSwgdGVtcGVyYXR1cmUgPSAwLjEgfSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuXG4gICAgLy8gRW5zdXJlIHdlIGhhdmUgdGV4dCB0byB3b3JrIHdpdGhcbiAgICBpZiAoIXRleHQgfHwgdHlwZW9mIHRleHQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbnZhbGlkIHRleHQgaW5wdXRcIik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VnZ2VzdGlvbjogXCJcIiwgZXJyb3I6IFwiSW52YWxpZCB0ZXh0IGlucHV0XCIgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCwgaGVhZGVycyB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgdXAgdG8gMzAwMCBjaGFyYWN0ZXJzIHdpdGggc21hcnRlciBjb250ZXh0IGhhbmRsaW5nXG4gICAgLy8gQWx3YXlzIGluY2x1ZGUgdGhlIGVudGlyZSBsYXN0IHBhcmFncmFwaCBmb3IgYmV0dGVyIGNvaGVyZW5jZVxuICAgIGxldCBjb250ZXh0ID0gdGV4dDtcbiAgICBpZiAodGV4dC5sZW5ndGggPiAzMDAwKSB7XG4gICAgICAvLyBGaW5kIGEgZ29vZCBicmVha3BvaW50IChwYXJhZ3JhcGggb3Igc2VudGVuY2UpXG4gICAgICBjb25zdCBsYXN0UGFyYWdyYXBoTWF0Y2ggPSB0ZXh0LnNsaWNlKC0zMDAwKS5tYXRjaCgvKD86XFxuXFxzKlxcbnxcXHJcXG5cXHMqXFxyXFxuKS8pO1xuICAgICAgY29uc3QgYnJlYWtQb2ludCA9IGxhc3RQYXJhZ3JhcGhNYXRjaCAmJiBsYXN0UGFyYWdyYXBoTWF0Y2guaW5kZXggIT09IHVuZGVmaW5lZFxuICAgICAgICA/IHRleHQubGVuZ3RoIC0gMzAwMCArIGxhc3RQYXJhZ3JhcGhNYXRjaC5pbmRleCBcbiAgICAgICAgOiB0ZXh0Lmxlbmd0aCAtIDMwMDA7XG4gICAgICBjb250ZXh0ID0gdGV4dC5zbGljZShicmVha1BvaW50KTtcbiAgICB9XG4gICAgXG4gICAgLy8gQW5hbHl6ZSB0aGUgdGV4dCBzdHJ1Y3R1cmUgZm9yIGJldHRlciBjb21wbGV0aW9uc1xuICAgIGNvbnN0IHN0cnVjdHVyZSA9IGFuYWx5emVUZXh0U3RydWN0dXJlKGNvbnRleHQpO1xuXG4gICAgLy8gQ3JlYXRlIGEgRGVlcFNlZWsgY2xpZW50XG4gICAgY29uc3QgY2xpZW50ID0gZ2V0RGVlcFNlZWtDbGllbnQoKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgXG4gICAgICAvLyBTZWxlY3QgdGhlIGFwcHJvcHJpYXRlIHByb21wdFxuICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gaXNNYXJrZG93biA/IE1BUktET1dOX1BST01QVCA6IFNZU1RFTV9QUk9NUFQ7XG4gICAgICBcbiAgICAgIC8vIEVuaGFuY2UgcHJvbXB0IHdpdGggc3RydWN0dXJlIGluZm8gZm9yIGJldHRlciBjb21wbGV0aW9uc1xuICAgICAgbGV0IGVuaGFuY2VkUHJvbXB0ID0gc3lzdGVtUHJvbXB0O1xuICAgICAgaWYgKHN0cnVjdHVyZS5lbmRzU2VudGVuY2UpIHtcbiAgICAgICAgZW5oYW5jZWRQcm9tcHQgKz0gXCJcXG5cXG5Ob3RlOiBUaGUgdXNlcidzIHRleHQgZW5kcyB3aXRoIGEgY29tcGxldGUgc2VudGVuY2UuIFN0YXJ0IGEgbmV3IHNlbnRlbmNlIHRoYXQgZm9sbG93cyBsb2dpY2FsbHkuXCI7XG4gICAgICB9IGVsc2UgaWYgKHN0cnVjdHVyZS5lbmRzV2l0aE5ld2xpbmUpIHtcbiAgICAgICAgZW5oYW5jZWRQcm9tcHQgKz0gXCJcXG5cXG5Ob3RlOiBUaGUgdXNlcidzIHRleHQgZW5kcyB3aXRoIGEgcGFyYWdyYXBoLiBTdGFydCBhIG5ldyBwYXJhZ3JhcGggd2l0aCBhIHJlbGF0ZWQgdGhvdWdodC5cIjtcbiAgICAgIH0gZWxzZSBpZiAoc3RydWN0dXJlLmlzTGlzdCkge1xuICAgICAgICBlbmhhbmNlZFByb21wdCArPSBcIlxcblxcbk5vdGU6IFRoZSB1c2VyIGlzIHdyaXRpbmcgYSBsaXN0LiBDb250aW51ZSB3aXRoIGFub3RoZXIgbGlzdCBpdGVtIGluIHRoZSBzYW1lIGZvcm1hdC5cIjtcbiAgICAgIH0gZWxzZSBpZiAoc3RydWN0dXJlLmlzSGVhZGluZykge1xuICAgICAgICBlbmhhbmNlZFByb21wdCArPSBcIlxcblxcbk5vdGU6IFRoZSB1c2VyIGp1c3Qgd3JvdGUgYSBoZWFkaW5nLiBDb250aW51ZSB3aXRoIGJvZHkgdGV4dCB1bmRlciB0aGF0IGhlYWRpbmcuXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbmhhbmNlZFByb21wdCArPSBcIlxcblxcbk5vdGU6IFRoZSB1c2VyIGlzIG1pZC1zZW50ZW5jZS4gQ29udGludWUgdGhhdCBleGFjdCBzZW50ZW5jZSBuYXR1cmFsbHkuXCI7XG4gICAgICB9XG5cbiAgICAgIC8vIEdlbmVyYXRlIGEgY29tcGxldGlvbiB3aXRoIG9wdGltaXplZCBwYXJhbWV0ZXJzIGZvciBmYXN0ZXIgcmVzcG9uc2VcbiAgICAgIGNvbnN0IGNvbXBsZXRpb24gPSBhd2FpdCBjbGllbnQuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgICBtb2RlbDogZ2V0RGVlcFNlZWtNb2RlbCgpLFxuICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6IFwic3lzdGVtXCIsXG4gICAgICAgICAgICBjb250ZW50OiBlbmhhbmNlZFByb21wdFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogY29udGV4dCB9XG4gICAgICAgIF0sXG4gICAgICAgIG1heF90b2tlbnM6IG1heFRva2VucyxcbiAgICAgICAgdGVtcGVyYXR1cmU6IHRlbXBlcmF0dXJlLFxuICAgICAgICB0b3BfcDogMC4xLFxuICAgICAgICBwcmVzZW5jZV9wZW5hbHR5OiAwLjAsIC8vIFJlZHVjZWQgZnVydGhlciBmb3IgZmFzdGVyIHN1Z2dlc3Rpb25zXG4gICAgICAgIGZyZXF1ZW5jeV9wZW5hbHR5OiAwLjAsIC8vIFJlZHVjZWQgZnVydGhlciBmb3IgZmFzdGVyIHN1Z2dlc3Rpb25zXG4gICAgICAgIHN0cmVhbTogZmFsc2VcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IHRpbWVUYWtlbiA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XG4gICAgICBcbiAgICAgIC8vIEV4dHJhY3QgdGhlIHN1Z2dlc3Rpb24gZnJvbSB0aGUgY29tcGxldGlvblxuICAgICAgbGV0IHN1Z2dlc3Rpb24gPSBjb21wbGV0aW9uLmNob2ljZXNbMF0/Lm1lc3NhZ2U/LmNvbnRlbnQgfHwgXCJcIjtcblxuICAgICAgLy8gTWluaW1hbCBjbGVhbmluZyBvZiB0aGUgc3VnZ2VzdGlvblxuICAgICAgc3VnZ2VzdGlvbiA9IHN1Z2dlc3Rpb24udHJpbSgpO1xuXG4gICAgICAvLyBQcm9jZXNzIG1hcmtkb3duIGNvbnRlbnQgYXBwcm9wcmlhdGVseVxuICAgICAgaWYgKGlzTWFya2Rvd24pIHtcbiAgICAgICAgc3VnZ2VzdGlvbiA9IHNhbml0aXplTWFya2Rvd24oc3VnZ2VzdGlvbik7XG4gICAgICAgIFxuICAgICAgICAvLyBFbnN1cmUgdGhlcmUgYXJlIG5vIEhUTUwgdGFncyBpbiB0aGUgbWFya2Rvd24gc3VnZ2VzdGlvblxuICAgICAgICBpZiAoc3VnZ2VzdGlvbi5pbmNsdWRlcygnPCcpICYmIHN1Z2dlc3Rpb24uaW5jbHVkZXMoJz4nKSkge1xuICAgICAgICAgIHN1Z2dlc3Rpb24gPSBzdWdnZXN0aW9uLnJlcGxhY2UoLzxcXC8/W14+XSsoPnwkKS9nLCBcIlwiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ2xlYW4gSFRNTCB0YWdzIGZyb20gbm9uLUhUTUwgY29udGVudCB3aGVuIGFwcHJvcHJpYXRlXG4gICAgICAgIGlmIChzdWdnZXN0aW9uLnN0YXJ0c1dpdGgoJzxwPicpIHx8IHN1Z2dlc3Rpb24uaW5jbHVkZXMoJzwvcD4nKSB8fCBcbiAgICAgICAgICAgIHN1Z2dlc3Rpb24uaW5jbHVkZXMoJzxoJykgfHwgc3VnZ2VzdGlvbi5pbmNsdWRlcygnPC9oJykpIHtcbiAgICAgICAgICBzdWdnZXN0aW9uID0gc3VnZ2VzdGlvbi5yZXBsYWNlKC88XFwvP1tePl0rKD58JCkvZywgXCJcIik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFJlbW92ZSBhbnkgbWFya2Rvd24gb3IgY29kZSBmb3JtYXR0aW5nXG4gICAgICAgIGlmIChzdWdnZXN0aW9uLnN0YXJ0c1dpdGgoXCJgYGBcIikgJiYgc3VnZ2VzdGlvbi5pbmNsdWRlcyhcIlxcblwiKSkge1xuICAgICAgICAgIHN1Z2dlc3Rpb24gPSBzdWdnZXN0aW9uLnNwbGl0KFwiXFxuXCIpLnNsaWNlKDEpLmpvaW4oXCJcXG5cIik7XG4gICAgICAgICAgaWYgKHN1Z2dlc3Rpb24uZW5kc1dpdGgoXCJgYGBcIikpIHtcbiAgICAgICAgICAgIHN1Z2dlc3Rpb24gPSBzdWdnZXN0aW9uLnNsaWNlKDAsIC0zKS50cmltKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEludGVsbGlnZW50bHkgYWRqdXN0IHRoZSBzdWdnZXN0aW9uIGJhc2VkIG9uIGNvbnRleHRcbiAgICAgIC8vIElmIHRleHQgZW5kcyB3aXRoIHNwYWNlIGFuZCBzdWdnZXN0aW9uIHN0YXJ0cyB3aXRoIHNwYWNlLCByZW1vdmUgb25lXG4gICAgICBpZiAodGV4dC5lbmRzV2l0aChcIiBcIikgJiYgc3VnZ2VzdGlvbi5zdGFydHNXaXRoKFwiIFwiKSkge1xuICAgICAgICBzdWdnZXN0aW9uID0gc3VnZ2VzdGlvbi5zdWJzdHJpbmcoMSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIElmIHRleHQgZG9lc24ndCBlbmQgd2l0aCBzcGFjZSBhbmQgc3VnZ2VzdGlvbiBkb2Vzbid0IHN0YXJ0IHdpdGggcHVuY3R1YXRpb24sIGFkZCBzcGFjZVxuICAgICAgaWYgKCF0ZXh0LmVuZHNXaXRoKFwiIFwiKSAmJiAhc3VnZ2VzdGlvbi5zdGFydHNXaXRoKFwiLlwiKSAmJiBcbiAgICAgICAgICAhc3VnZ2VzdGlvbi5zdGFydHNXaXRoKFwiLFwiKSAmJiAhc3VnZ2VzdGlvbi5zdGFydHNXaXRoKFwiIVwiKSAmJiBcbiAgICAgICAgICAhc3VnZ2VzdGlvbi5zdGFydHNXaXRoKFwiP1wiKSAmJiAhc3VnZ2VzdGlvbi5zdGFydHNXaXRoKFwiOlwiKSAmJiBcbiAgICAgICAgICAhc3VnZ2VzdGlvbi5zdGFydHNXaXRoKFwiO1wiKSAmJiAhc3VnZ2VzdGlvbi5zdGFydHNXaXRoKFwiKVwiKSAmJlxuICAgICAgICAgICF0ZXh0LmVuZHNXaXRoKFwiXFxuXCIpICYmIHN1Z2dlc3Rpb24ubGVuZ3RoID4gMCkge1xuICAgICAgICBzdWdnZXN0aW9uID0gXCIgXCIgKyBzdWdnZXN0aW9uO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXR1cm4gdGhlIHN1Z2dlc3Rpb24gd2l0aCB0aW1pbmcgaW5mb1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXG4gICAgICAgIHN1Z2dlc3Rpb24sIFxuICAgICAgICB0aW1lVGFrZW4sXG4gICAgICAgIGFuYWx5c2lzOiB7XG4gICAgICAgICAgZW5kc1NlbnRlbmNlOiBzdHJ1Y3R1cmUuZW5kc1NlbnRlbmNlLFxuICAgICAgICAgIGVuZHNXaXRoTmV3bGluZTogc3RydWN0dXJlLmVuZHNXaXRoTmV3bGluZSxcbiAgICAgICAgICBpc0xpc3Q6IHN0cnVjdHVyZS5pc0xpc3QsXG4gICAgICAgICAgaXNIZWFkaW5nOiBzdHJ1Y3R1cmUuaXNIZWFkaW5nXG4gICAgICAgIH1cbiAgICAgIH0sIHsgaGVhZGVycyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyBIYW5kbGUgZXJyb3JzIHdpdGggY29uc2lzdGVudCByZXNwb25zZSBmb3JtYXR0aW5nXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZ2VuZXJhdGluZyBjb21wbGV0aW9uOlwiLCBlcnJvcik7XG4gICAgICBcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBcbiAgICAgICAgICBzdWdnZXN0aW9uOiBcIlwiLCBcbiAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCBcIkZhaWxlZCB0byBnZW5lcmF0ZSBzdWdnZXN0aW9uXCIsXG4gICAgICAgICAgc3RhdHVzOiBlcnJvci5zdGF0dXMgfHwgNTAwXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5zdGF0dXMgfHwgNTAwLCBoZWFkZXJzIH1cbiAgICAgICk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBwcm9jZXNzaW5nIHJlcXVlc3Q6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IHN1Z2dlc3Rpb246IFwiXCIsIGVycm9yOiBcIkludGVybmFsIHNlcnZlciBlcnJvclwiIH0sXG4gICAgICB7IHN0YXR1czogNTAwLCBoZWFkZXJzIH1cbiAgICApO1xuICB9XG59ICJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJPcGVuQUkiLCJzYW5pdGl6ZU1hcmtkb3duIiwiVElNRU9VVF9NUyIsIm1heER1cmF0aW9uIiwiU1lTVEVNX1BST01QVCIsIk1BUktET1dOX1BST01QVCIsImFuYWx5emVUZXh0U3RydWN0dXJlIiwidGV4dCIsInRyaW1tZWRUZXh0IiwidHJpbSIsImVuZHNTZW50ZW5jZSIsInRlc3QiLCJlbmRzV2l0aE5ld2xpbmUiLCJpc0xpc3QiLCJzcGxpdCIsInBvcCIsImlzSGVhZGluZyIsImdldERlZXBTZWVrQ2xpZW50IiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIkRFRVBTRUVLX0FQSV9LRVkiLCJiYXNlVVJMIiwidGltZW91dCIsImdldERlZXBTZWVrTW9kZWwiLCJQT1NUIiwicmVxdWVzdCIsImhlYWRlcnMiLCJjb25zb2xlIiwiZXJyb3IiLCJqc29uIiwic3VnZ2VzdGlvbiIsInN0YXR1cyIsImlzTWFya2Rvd24iLCJtYXhUb2tlbnMiLCJ0ZW1wZXJhdHVyZSIsImNvbnRleHQiLCJsZW5ndGgiLCJsYXN0UGFyYWdyYXBoTWF0Y2giLCJzbGljZSIsIm1hdGNoIiwiYnJlYWtQb2ludCIsImluZGV4IiwidW5kZWZpbmVkIiwic3RydWN0dXJlIiwiY2xpZW50Iiwic3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsInN5c3RlbVByb21wdCIsImVuaGFuY2VkUHJvbXB0IiwiY29tcGxldGlvbiIsImNoYXQiLCJjb21wbGV0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsIm1heF90b2tlbnMiLCJ0b3BfcCIsInByZXNlbmNlX3BlbmFsdHkiLCJmcmVxdWVuY3lfcGVuYWx0eSIsInN0cmVhbSIsImVuZFRpbWUiLCJ0aW1lVGFrZW4iLCJjaG9pY2VzIiwibWVzc2FnZSIsImluY2x1ZGVzIiwicmVwbGFjZSIsInN0YXJ0c1dpdGgiLCJqb2luIiwiZW5kc1dpdGgiLCJzdWJzdHJpbmciLCJhbmFseXNpcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/generate-suggestion/route.ts\n");

/***/ }),

/***/ "(rsc)/./app/lib/markdown-utils.ts":
/*!***********************************!*\
  !*** ./app/lib/markdown-utils.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateMarkdownFromNode: () => (/* binding */ generateMarkdownFromNode),\n/* harmony export */   sanitizeMarkdown: () => (/* binding */ sanitizeMarkdown)\n/* harmony export */ });\n/**\n * Converts a TipTap document node to Markdown\n * This is a simplified version that focuses on common elements\n */ function generateMarkdownFromNode(doc) {\n    let markdown = \"\";\n    doc.descendants((node, pos, parent)=>{\n        // Handle different node types\n        if (node.type.name === \"paragraph\") {\n            const content = node.textContent;\n            if (content) {\n                markdown += content + \"\\n\\n\";\n            }\n            return false // Don't traverse children, we got the text\n            ;\n        }\n        // Handle headings\n        if (node.type.name === \"heading\") {\n            const level = node.attrs.level;\n            const content = node.textContent;\n            const prefix = \"#\".repeat(level) + \" \";\n            markdown += prefix + content + \"\\n\\n\";\n            return false;\n        }\n        // Handle bulletLists\n        if (node.type.name === \"bulletList\") {\n            // We'll handle list items individually\n            return true // Continue traversing\n            ;\n        }\n        // Handle orderedLists\n        if (node.type.name === \"orderedList\") {\n            // We'll handle list items individually  \n            return true // Continue traversing\n            ;\n        }\n        // Handle listItem\n        if (node.type.name === \"listItem\") {\n            let content = node.textContent;\n            // Check if parent is bulletList or orderedList\n            if (parent?.type.name === \"bulletList\") {\n                markdown += \"- \" + content + \"\\n\";\n            } else if (parent?.type.name === \"orderedList\") {\n                // Since we don't have item index, use 1 for all\n                markdown += \"1. \" + content + \"\\n\";\n            }\n            return false;\n        }\n        // Handle blockquote\n        if (node.type.name === \"blockquote\") {\n            const content = node.textContent;\n            markdown += \"> \" + content + \"\\n\\n\";\n            return false;\n        }\n        // Handle code blocks\n        if (node.type.name === \"codeBlock\") {\n            const content = node.textContent;\n            const language = node.attrs.language || \"\";\n            markdown += \"```\" + language + \"\\n\" + content + \"\\n```\\n\\n\";\n            return false;\n        }\n        // Handle horizontal rule\n        if (node.type.name === \"horizontalRule\") {\n            markdown += \"---\\n\\n\";\n            return false;\n        }\n        return true // Continue traversing \n        ;\n    });\n    return markdown.trim();\n}\n/**\n * Sanitizes markdown for use in completions\n */ function sanitizeMarkdown(markdown) {\n    // Remove any potential code block wrappers from the AI response\n    if (markdown.startsWith(\"```\") && markdown.includes(\"\\n\")) {\n        const lines = markdown.split(\"\\n\");\n        const firstLine = lines[0];\n        // If first line is just ``` or ```language, remove it\n        if (firstLine.match(/^```[a-z]*$/)) {\n            lines.shift();\n        }\n        // If last line is just ```, remove it\n        if (lines[lines.length - 1] === \"```\") {\n            lines.pop();\n        }\n        return lines.join(\"\\n\");\n    }\n    return markdown;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU96QjtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2FwcC9saWIvbWFya2Rvd24tdXRpbHMudHM/OGIyMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOb2RlIH0gZnJvbSAnQHRpcHRhcC9wbS9tb2RlbCdcblxuLyoqXG4gKiBDb252ZXJ0cyBhIFRpcFRhcCBkb2N1bWVudCBub2RlIHRvIE1hcmtkb3duXG4gKiBUaGlzIGlzIGEgc2ltcGxpZmllZCB2ZXJzaW9uIHRoYXQgZm9jdXNlcyBvbiBjb21tb24gZWxlbWVudHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlTWFya2Rvd25Gcm9tTm9kZShkb2M6IE5vZGUpOiBzdHJpbmcge1xuICBsZXQgbWFya2Rvd24gPSAnJ1xuICBcbiAgZG9jLmRlc2NlbmRhbnRzKChub2RlLCBwb3MsIHBhcmVudCkgPT4ge1xuICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgbm9kZSB0eXBlc1xuICAgIGlmIChub2RlLnR5cGUubmFtZSA9PT0gJ3BhcmFncmFwaCcpIHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBub2RlLnRleHRDb250ZW50XG4gICAgICBpZiAoY29udGVudCkge1xuICAgICAgICBtYXJrZG93biArPSBjb250ZW50ICsgJ1xcblxcbidcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZSAvLyBEb24ndCB0cmF2ZXJzZSBjaGlsZHJlbiwgd2UgZ290IHRoZSB0ZXh0XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBoZWFkaW5nc1xuICAgIGlmIChub2RlLnR5cGUubmFtZSA9PT0gJ2hlYWRpbmcnKSB7XG4gICAgICBjb25zdCBsZXZlbCA9IG5vZGUuYXR0cnMubGV2ZWxcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBub2RlLnRleHRDb250ZW50XG4gICAgICBjb25zdCBwcmVmaXggPSAnIycucmVwZWF0KGxldmVsKSArICcgJ1xuICAgICAgXG4gICAgICBtYXJrZG93biArPSBwcmVmaXggKyBjb250ZW50ICsgJ1xcblxcbidcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgYnVsbGV0TGlzdHNcbiAgICBpZiAobm9kZS50eXBlLm5hbWUgPT09ICdidWxsZXRMaXN0Jykge1xuICAgICAgLy8gV2UnbGwgaGFuZGxlIGxpc3QgaXRlbXMgaW5kaXZpZHVhbGx5XG4gICAgICByZXR1cm4gdHJ1ZSAvLyBDb250aW51ZSB0cmF2ZXJzaW5nXG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBvcmRlcmVkTGlzdHNcbiAgICBpZiAobm9kZS50eXBlLm5hbWUgPT09ICdvcmRlcmVkTGlzdCcpIHtcbiAgICAgIC8vIFdlJ2xsIGhhbmRsZSBsaXN0IGl0ZW1zIGluZGl2aWR1YWxseSAgXG4gICAgICByZXR1cm4gdHJ1ZSAvLyBDb250aW51ZSB0cmF2ZXJzaW5nXG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBsaXN0SXRlbVxuICAgIGlmIChub2RlLnR5cGUubmFtZSA9PT0gJ2xpc3RJdGVtJykge1xuICAgICAgbGV0IGNvbnRlbnQgPSBub2RlLnRleHRDb250ZW50XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIHBhcmVudCBpcyBidWxsZXRMaXN0IG9yIG9yZGVyZWRMaXN0XG4gICAgICBpZiAocGFyZW50Py50eXBlLm5hbWUgPT09ICdidWxsZXRMaXN0Jykge1xuICAgICAgICBtYXJrZG93biArPSAnLSAnICsgY29udGVudCArICdcXG4nXG4gICAgICB9IGVsc2UgaWYgKHBhcmVudD8udHlwZS5uYW1lID09PSAnb3JkZXJlZExpc3QnKSB7XG4gICAgICAgIC8vIFNpbmNlIHdlIGRvbid0IGhhdmUgaXRlbSBpbmRleCwgdXNlIDEgZm9yIGFsbFxuICAgICAgICBtYXJrZG93biArPSAnMS4gJyArIGNvbnRlbnQgKyAnXFxuJ1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIGJsb2NrcXVvdGVcbiAgICBpZiAobm9kZS50eXBlLm5hbWUgPT09ICdibG9ja3F1b3RlJykge1xuICAgICAgY29uc3QgY29udGVudCA9IG5vZGUudGV4dENvbnRlbnRcbiAgICAgIG1hcmtkb3duICs9ICc+ICcgKyBjb250ZW50ICsgJ1xcblxcbidcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgY29kZSBibG9ja3NcbiAgICBpZiAobm9kZS50eXBlLm5hbWUgPT09ICdjb2RlQmxvY2snKSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gbm9kZS50ZXh0Q29udGVudFxuICAgICAgY29uc3QgbGFuZ3VhZ2UgPSBub2RlLmF0dHJzLmxhbmd1YWdlIHx8ICcnXG4gICAgICBcbiAgICAgIG1hcmtkb3duICs9ICdgYGAnICsgbGFuZ3VhZ2UgKyAnXFxuJyArIGNvbnRlbnQgKyAnXFxuYGBgXFxuXFxuJ1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBob3Jpem9udGFsIHJ1bGVcbiAgICBpZiAobm9kZS50eXBlLm5hbWUgPT09ICdob3Jpem9udGFsUnVsZScpIHtcbiAgICAgIG1hcmtkb3duICs9ICctLS1cXG5cXG4nXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRydWUgLy8gQ29udGludWUgdHJhdmVyc2luZyBcbiAgfSlcbiAgXG4gIHJldHVybiBtYXJrZG93bi50cmltKClcbn1cblxuLyoqXG4gKiBTYW5pdGl6ZXMgbWFya2Rvd24gZm9yIHVzZSBpbiBjb21wbGV0aW9uc1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2FuaXRpemVNYXJrZG93bihtYXJrZG93bjogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gUmVtb3ZlIGFueSBwb3RlbnRpYWwgY29kZSBibG9jayB3cmFwcGVycyBmcm9tIHRoZSBBSSByZXNwb25zZVxuICBpZiAobWFya2Rvd24uc3RhcnRzV2l0aCgnYGBgJykgJiYgbWFya2Rvd24uaW5jbHVkZXMoJ1xcbicpKSB7XG4gICAgY29uc3QgbGluZXMgPSBtYXJrZG93bi5zcGxpdCgnXFxuJylcbiAgICBjb25zdCBmaXJzdExpbmUgPSBsaW5lc1swXVxuICAgIFxuICAgIC8vIElmIGZpcnN0IGxpbmUgaXMganVzdCBgYGAgb3IgYGBgbGFuZ3VhZ2UsIHJlbW92ZSBpdFxuICAgIGlmIChmaXJzdExpbmUubWF0Y2goL15gYGBbYS16XSokLykpIHtcbiAgICAgIGxpbmVzLnNoaWZ0KClcbiAgICB9XG4gICAgXG4gICAgLy8gSWYgbGFzdCBsaW5lIGlzIGp1c3QgYGBgLCByZW1vdmUgaXRcbiAgICBpZiAobGluZXNbbGluZXMubGVuZ3RoIC0gMV0gPT09ICdgYGAnKSB7XG4gICAgICBsaW5lcy5wb3AoKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbGluZXMuam9pbignXFxuJylcbiAgfVxuICBcbiAgcmV0dXJuIG1hcmtkb3duXG59ICJdLCJuYW1lcyI6WyJnZW5lcmF0ZU1hcmtkb3duRnJvbU5vZGUiLCJkb2MiLCJtYXJrZG93biIsImRlc2NlbmRhbnRzIiwibm9kZSIsInBvcyIsInBhcmVudCIsInR5cGUiLCJuYW1lIiwiY29udGVudCIsInRleHRDb250ZW50IiwibGV2ZWwiLCJhdHRycyIsInByZWZpeCIsInJlcGVhdCIsImxhbmd1YWdlIiwidHJpbSIsInNhbml0aXplTWFya2Rvd24iLCJzdGFydHNXaXRoIiwiaW5jbHVkZXMiLCJsaW5lcyIsInNwbGl0IiwiZmlyc3RMaW5lIiwibWF0Y2giLCJzaGlmdCIsImxlbmd0aCIsInBvcCIsImpvaW4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/lib/markdown-utils.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/formdata-node","vendor-chunks/next","vendor-chunks/tr46","vendor-chunks/openai","vendor-chunks/web-streams-polyfill","vendor-chunks/@opentelemetry","vendor-chunks/node-fetch","vendor-chunks/whatwg-url","vendor-chunks/event-target-shim","vendor-chunks/agentkeepalive","vendor-chunks/form-data-encoder","vendor-chunks/webidl-conversions","vendor-chunks/abort-controller","vendor-chunks/ms","vendor-chunks/humanize-ms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-suggestion%2Froute&page=%2Fapi%2Fgenerate-suggestion%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-suggestion%2Froute.ts&appDir=%2FUsers%2Feinar%2FDocuments%2FGitHub%2Fwriting-app%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Feinar%2FDocuments%2FGitHub%2Fwriting-app&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();